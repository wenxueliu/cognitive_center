---
title: 分层架构层间依赖原则
type: entity
permalink: layered-architecture-dependency-principles
tags:
- 分层架构
- DDD
- 架构设计
- 依赖倒置
- 软件工程
status: active
aliases:
- 分层架构
- Layered Architecture
- 层间依赖
---

# 分层架构层间依赖原则

## 📊 层次结构定义
**[principle]** DDD分层架构遵循严格的依赖方向，确保架构清晰性和可维护性

## 🎯 四层架构依赖关系
**[design]** 遵循核心原则：
1. **上层依赖下层**：用户界面层 → 应用层 → 领域层 → 基础设施层
2. **框架无关性**：Application层和Domain层与具体框架无关

### 各层依赖流向图
```
用户界面层 User Interface
    ↓ 依赖
应用层 Application    
    ↓ 依赖
领域层 Domain
    ↓ 依赖  
基础设施层 Infrastructure
    ↑←依赖倒置
(基础设施层实现上层定义的接口)
```

## 🔧 各层职责详解

### 用户界面层 (Presentation Layer)
**[feature]** 处理用户交互和展示逻辑
- 接收用户输入和请求
- 展示处理结果给用户  
- 格式化和渲染数据

**[tech]** 技术栈无限制，可以是Web、移动端或CLI

### 应用层 (Application Layer)  
**[design]** 协调领域对象执行业务用例
**[feature]** 核心职责：
- 编排领域对象执行业务流程
- 负责事务管理和安全控制
- 处理DTO转换和数据验证
- **与框架无关**：保持纯业务逻辑

### 领域层 (Domain Layer) - 核心
**[principle]** 业务规则和领域逻辑的核心载体
**[feature]** 关键组件：
- **实体(Entity)**: 具有唯一标识的业务对象
- **值对象(Value Object)**: 描述性特征，无标识
- **领域服务(Domain Service)**: 跨实体业务逻辑
- **领域事件(Domain Event)**: 业务重要状态变更
- **仓储接口(Repository Interface)**: 数据访问抽象

**[design]** **与框架无关**：纯业务逻辑，不依赖技术细节

### 基础设施层 (Infrastructure Layer)
**[feature]** 技术实现和外部系统集成
**[tech]** 技术组件：
- 数据持久化实现
- 外部API集成  
- 消息队列集成
- 缓存和搜索系统
- 日志和监控基础设施

## 🎯 依赖倒置模式
**[design]** 通过依赖倒置实现架构解耦：

### 传统依赖 vs 依赖倒置
```
传统流向：    UI → Application → Domain → Infrastructure
依赖倒置：  Application ← Infrastructure
            Domain    ← Infrastructure
```

**[method]** 实现方式：
- 高层定义接口（Application/Domain层定义Repository接口）
- 底层实现接口（Infrastructure层实现具体技术）
- 通过依赖注入连接各层

## ⚠️ 架构边界保护
**[issue]** 必须严格保护的架构边界：

### 禁止反向依赖
**[problem]** 不允许下层调用上层：
- ❌ Infrastructure调用Domain逻辑
- ❌ Domain依赖UI实现  
- ❌ Application直接操作数据库技术细节

### 技术泄露防控
**[issue]** 防止技术细节泄露到业务层：
- 数据库查询语言只能在Infrastructure层
- HTTP请求处理保持在UI层  
- ORM实体不应暴露给Domain层

## 🛠️ 技术实现模式
**[method]** 标准实现模式：

### 依赖注入配置示例
```java
// Domain层定义接口
public interface OrderRepository {
    Order findById(OrderId id);
}

// Infrastructure层实现
@Repository  
public class JpaOrderRepository implements OrderRepository {
    // JPA实现细节，对Domain层透明
}
```

### 防腐层(Anti-Corruption Layer)
**[design]** 在Infrastructure层实现技术防腐层：
- DTO到领域模型的转换
- 外部API响应适配
- 数据库实体与领域模型的映射

## 🔗 与领域驱动设计的关系
**[design]** 分层架构是DDD的战术实现基础：
- **领域层集中业务逻辑**：确保业务内聚性
- **界限上下文映射**：不同上下文的层间交互模式
- **最终一致性**：通过领域事件实现层间最终一致性

---
## Relations  
- part_of [[领域驱动设计_DDD核心概念]]
- relates_to [[依赖倒置原则DI]]
- pairs_with [[六边形架构HexagonalArchitecture]]
- extends [[清洁架构CleanArchitecture]]

---
## Observations  
-[principle] 上层依赖下层是架构稳定性的基础 #dependency-flow
-[design] Application和Domain层的框架无关性保证业务逻辑纯洁性 #business-logic-isolation
-[tech] 依赖注入是实现层间解耦的关键技术 #dependency-injection  
-[issue] 架构边界的侵fan是最常见的破坏模式 #architecture-boundary-protection
-[method] 防腐层可以有效隔离技术变化对业务的影响 #anti-corruption-layer